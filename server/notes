general:
npm start   ----   changed to this in script from: node index.js run from inside server folder will start the express server
early heroku deployment - I like this so far
I never knew when you could/should deploy, but this guy is doing it as soon as express is set up
     I like this because it feels like solid footing, somthing to stand on, an answer to a question


both parent and child folders are git initialized.  not sure if this might come back to bite me at some point
I was primarially using the parent folder to track to github
the server folder has it's own git file - this one is the one that I can use to automatically depoloy to heroku
by using git push heroku master

--In production the create-react-app server does not exist
--the proxy file inside the react app rewrites requests from 3000 to 5000
heroku notes:
  deployed project: https://serene-hollows-22376.herokuapp.com
  heroku dictates which ports your app needs to listen to
  I don't recall what the following does, but for some reason
  we need to use a specific verson of npm and node? seems odd
  "engines": {
      "node": "8.1.1",
      "npm": "5.0.3"
    },

    Logging in... done
  Logged in as beckaaronr@gmail.com
  Aarons-MacBook-Air:server aaronrbeck$ heroku create
  Creating app... done, ⬢ serene-hollows-22376
  https://serene-hollows-22376.herokuapp.com/ | https://git.heroku.com/serene-hollows-22376.git
  serene-hollows-22376                                    indentifies name of your app to heroku        
  https://serene-hollows-22376.herokuapp.com/             where we send visitors
  https://git.heroku.com/serene-hollows-22376.git         deployment target a git repository that we can push our local code base to

  heroku open     will open your projct in a browser window
  if browser does not deploy heroku project view logs with
  heroku logs







once you add a folder or file to git, it should be "greyed out"






google oauth notes:
passport has at least 2 libraries:

- passport : general helpers
- passport strategy: helps for authenticating one specific method





Lesson 25 - set up app.get in index.js
lesson 26 - fix the google redirect error by providing a valid redirect url
lesson 27 - got user token to console.log in termianl
lesson 28 - after our user comes back with a valid token after granting us passport access we can now save them to our database
lesson 29 - added nodemon
lesson 30 - server structure refactor
lesson 31 - theory of authentication lecture
lesson 32 - signing in users with oauth lecture
lesson 33 - mongo lecture
lesson 34 - setup mongoatlas cluster added mongo cluster info to keys.js
lesson 35 - mlab setup info - I skipped this as mLab does not exist
lesson 36 - npm install mongoose
lesson 37 - mongo lecture
lesson 38 - added User.js and a mongoose schema to users.js and created a mongo model class
lesson 39 - a lot of explaination, might be worth a re-watch, save a new record to mongodb
lesson 40 - modified callback in passport js to prevent duplicate users from being created in mongodb
lesson 41 - added "done" to our callback statement in passport.js
42 - added .serializeUser to passport.js
43 - added .deserializeUser to passport.js
44 - tell passport to use cookies, added cookie-session because express does not know how to handle cookies
  required cookie-session as well as passport on import statements in index.js
  added app.use(cookieSession({})) in index.js
  added keys to keys.js for our cookie session

45 - added app.get('/api/current_user', (req, res) to authRoutes.js
46 - added app.get('/api/logout', (req, res) to authRoutes.js
47 - lecture on difference between cookie sessions and epress session modules
  cookie-session info is store in the actual cookie - about 4kb max
  express session module stores a reference in the cookie, which allows you to store way more info in an off-site db storage apporpriate
  for this project since all we are storing is id in the cookie, cookie-session works and is 
  way more simple as express session requires some "store" decisions to be made
  we can use inspector / network to view how cookies get used
48 - lecture on why we should have seperate dev keys&db and prod keys&db
49 - 
50 - setting up production credentials for google oauth
51 - finding heroku redirect url for google oauth credentials
52 - changed keys and added prod.js propbably need to watch this again
53 - modified config values over at heroku
54 - supposed to have deployed via heroku, but the heroku version is not starting/running properly.


55 - create-react-app client inside servrer folder
56 - I never knew before that create-react-app creates it's own server.  i guess I knew as much
  but I guess I never really thought about it in those explicit terms.  but, duh, npm start then localhost3000 spins up, duh.
  added hi from app
57 - added client script to our serverr package.json to run the react servre starter
    added dev script and installed concurrently dependancy
58 - written update addressing proxy errors with create react app 2 and 3.0
59 - added proxy in the client packagejson which somehow helps direct the auth flow no matter whether we are in dev mode or prod mode
60 - added
61 - architecture theory lecture

section 7 - Developing the client side
62 - some refactoring theory/lecture.  best explaination I've seen on async await - this was the shit I tried to pay 10k to get and didn't get.  so pissed so often
63 - refactored passport.js to async/await
64 - finish a back end segment, then add corresponding front end, but don't do at the same time or you will end up with spaghetti code
  review of front end plan
65 - redux dependancies added
      instructor deleted all but registerServiceWorker.js in his src folder - I didn't do that yet. 
      index.js is the redux layer
      app.js is react router stuff
      added dependancies in client directory:npm install --save redux react-redux react-routher-dom
66 - re-wrote index and app.js files, terminal says things compiled
67 - instructor had an error related to his version of npm, he removed his json.lock file and installed a new one
68 - importer provider tag and setup some redux info
69 - added authReducer file
70 - imported authReducer to main react index.js
71 - react page component layout discussion
72 - initial react router setup
73 - 
74 - initial route setup - exact route for /
75 - finish initial route setup
76 - added materialize dependancy
77 - hooking up materialize parts
    materialize takes advantage of 'webpacks' that come with react
    webpack allows us to npm install css libraries such as materialize library
    import materialize-css/dist/css/materialize.min.css to main index.js
78 - applied header styling
79 - lecture: materialize requires one root container
    how do we figure out if user is logged in?
80 - SOME PROXY MODIFICATIONS - I DON'T THINK I NEED THEM?
      installed redux thunk(helps async requests behave) and axios(helps with ajax requests) libraries
      at some point you need to do some reading about redux (or not, just learn hooks) action creators


81 - wrote action creator using redux thunk and axios
    redux thunk give us direct access allowing us to manually dispatch the dispactch function
    refactored fetchUser inside src/index.js to use redux thunk
    yea, I don't understand redux - need to do some reading/learning

82 - refactor the app.js file from functional to class component
      because we want to place the action creator inside the app component because multiple components willl need to know when the user is logged in, not just the nav bar
83 - testing fetch user - this would be worth re-watching after you better understand redux
84 - refactor to async await syntax - i need more experience with refactoring - couldn't do this on my own
85 - changed authReducer's initials state to null and FETCH_USER  state as action.payload || false
    changed payload from res to res.data because we don't care about seeing other payloads like headers in the console.log
86 - added render content function to header.js so that we can display different logged in status on header
87 - added switch statment to header renderContent for sign in flow
88 - added another route handler to authRouits for after sign in redirect
89 - logout philosophy and changed authRout for a redirect logout to /
    we went with a full page refresh, ajax route would be faster for user
90 - created landing component and imported to app.js
91 - finished header: home link directs to /surveys or / depending on login status

Section 8: Handling Payments
92 - lecture, app overview, billing introduction
93 - lecture, billing; add credit overview, instructor billing best practices
      the collective we are bad a securtiy
      #1 never accept raw credit card numbers
      #2 never store cc numbers 
      #3 always use outside payment processor
        we will use strip

      Billing is hard   
      * is it possible to avoid monthly payments/multiple plans?
      * fraud and chargebacks are a pain


94 - stripe lecture and initial setup
  secret key will go in backend keys file
  publishable key will go in front end
  stripe checkout; checkout.js - react is slightly different than other front end frameworks
  install react-stripe-checkout 
95 - strip api keys
  keys put on server side: dev, prod, heroku
  keys placed on front end
  interesting info near the end about how es15 syntax does not allow for logic before an import statment, but classic syntax does allow for logic before imports

96 - react key processor
    define strip key as environment variable
97 - added .env.development and .env.production and added them to git ignore
98 - react stripe checkout component
      stripe checout with three required parameters

99  -stripe tokens - added payment button to header component
100 - resolved key warning from console, customized stripe payment properties, changed stripe button styling
101 - wrote action creator in src/actions/index.js for when tokens are added
102 - import connect and * in payments.js, changed parameter from console logging to         token={token => this.props.handleToken(token)}
103 - added express route handler, required billing routes in the express index.js
104 - install module for server side strip api
      documentation lecture: stripe
      when you charge a cc, you create a stripe "charge" object
105 - bring in secretStripeKey into billingRoutes
    express does not parse post payloads, so we added body-parser middleware
    
106 - changed billingRoutes.js to handle stripe.charges on the back end
107 - refactored stripe.charges to async
108 - added a credits (default 0) to user model class inside server/models/user.js
109 - added niave method to check to see if someone is logged in before adding credits
110 - refactored billingRoutes.js to use new middleware created at requireLogin.js to check login status at specific route points
111 - added credit status in header
112 - lecture: explaination on how user model update flow works, watch again.  review this

section 9 back end to front end routing in production
113 - lecture: express server behavior - review
      how do we ensure that express handles all our assets in production mode, because in production mode create react app no longer exists?
      if a user tries to access a route not defined in express, we want express to assume that the user is tyring to access a route defined by react router
        so get express to hand off the react index.html file
        so then the index.html asks express to see the client/build/static/js/main.js file
        at this point browser has access to react information and it can know which component(s) to look at
114 - added to server index.js logic for production route handling
115 - lecture: deployment methods/philosophies
116 - added server package.json script for heroku deployment-production builds
117 - lecture of some sort


section 10 mongoose for survey creation
118 - survey planning lecture
119 - survey route planning lecture
120 - add survey route handler
    created a new mongoose model class
    added survey.js
    modified server's index.js file to import survey.js
121 - embedd a sub-document-collection in our recipients property 
  in the survey model in order to track whether a person has provided feedback
    - think about how to implement the y/n votes
    - modifed survey schema to include the y/n counter
122 - lecture: mongoose sub-document collection 
      mongo db has a document limit of 4mb 
123 - modified survey.js to create a mongoose sub-document collection via importing the recipient schema
124 - add _user property to set up relationship between survey and user in survey.js
      added dateSent and lastResponded properties to help user
125 - create surveyRoutes.js handler, 
126 - create middleware to check if user has enough credits to make a survey
127 - started setting up a new survey instance in surveyRoutes.js
128 - fished creating survey property
129 - modification to subdocument creation in order to trim white space off between entries
130 - lecture that I pretty much slept through
131 - lecture - sendGrid overview slept through this one too
    sendgrid info
132 - sign up with sendGrid, set up production and dev keys, install sendGrid module
133 - start to set up mailer object
134 - I have absolutely no clue what just happened, at all.  mailer surveyTemplate mumbo jumbo
135 - fill out implementation of mailer
136 - added helper function formatAddress to the mailer.js file
137 - finished writing the nasty logic of sendgrid - no idea what is going on
138 - still not sure what happened here.  the instructor keeps calling this sendgrid library ugly, I'm burnt, tired no clue what I just did 
139 - used axios to do a rest test through the terminal - worth watching again and learning how to do this for yourself
  need to do a rest test, but postman is no good because of oauth flow
    instead he is somehow going to use axios because info we want to verify is in cookie?
    ok, this is sorta interesting.  in inspector console he uses axios to write test crud calls
    he makes a teste survey in the console


140 - rewrote surveyTemplate.js to return
141
142
143


where I'm stuck:














a1

how I got unstuck:


lesson 25- spelling error
  tried to start server at 5000 by running node index.js
  I got this: passport.use(new GoogleStrategy({
              ^

  TypeError: GoogleStrategy is not a constructor
  over at index.js I'm told:
  Could not find a declaration file for module 'passport-google-oauth20
  so I never npm installed google oauth 2.0?
  I went back and re-watched lesson 19
  so I went back and npm install --save passport-google-oauth20 and still no love.
  I checked spelling on passport import statements - no love there either
  Ok, I think i found the problem: it was a misspelling.  I changed my incorrect require('passport-google-oauth20').Strategy20
  to require('passport-google-oauth20').Strategy

lesson 26/27  - re-did things 3 times


  so I created credentials with http://localhost:5000 and http://localhost:5000/auth/google/callback in the apporpriate input boxes
  I've added clientID and client secret to keys.js, 
  then ran node index.js, then navigate to localhost:5000/auth/google in browser
  I'm still landing on the Error: redirect_uri_mismatchm, following the console link does actually take me back to the correct developer console
  that was not the case only moments ago.  I will give google 5 minutes to get things in their system.  fingers crossed
  I'm in.  not sure why/how, but oh, well

lesson 39 - import order of operations
  This was actually something that the instructor walkec
  us through, but still something good to remember - 
  if server crashes or does not start it may be due to 
  over of operations of require statements

 


53 - went back and reviewed earlier lessons and realized that I have 2 git initialized folders, the parent folder and the server folder
      the server folder was what the instructur had connected to heroku auto deployments
  i got the following message: 
  Aarons-MacBook-Air:udemynodewithreact aaronrbeck$ git push heroku master
  fatal: 'heroku' does not appear to be a git repository
  fatal: Could not read from remote repository.

  Please make sure you have the correct access rights
  and the repository exists.

  so I guess I need to go back to where we set up heroku and understand how git is connected to heroku for this project



59/60 ish: - with some research I decided to revert to a prior babel version.
            so far problem seems solved via
             https://github.com/creativetimofficial/ct-material-dashboard-pro-react/issues/62



      I ran:  npm install --save-exact @babel/runtime@7.0.0-beta.55


    the dual server deployment workflow is messed up.
    I need a break.  brain hurts. go back and check lesson 58.
    I'm confused as to how the proxy file works and whether we need to pull the 
    proxy statments out of the client packagejson
    when I run npm run dev the server side server starts at 5000, but react does not start at 3000
    and I get an error pointing towards babel: 
    Failed to compile.
    [1] 
    [1] ./node_modules/react-dev-utils/formatWebpackMessages.js
    [1] Module not found: Can't resolve '/Users/aaronrbeck/Documents/Assignments/sandbox/udemynodewithreact/server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray' in '/Users/aaronrbeck/Documents/Assignments/sandbox/udemynodewithreact/server/client/node_modules/react-dev-utils'
    [1] Compiling...
    [1] Failed to compile.
    [1] 
    [1] ./node_modules/react-dev-utils/formatWebpackMessages.js
    [1] Module not found: Can't resolve '/Users/aaronrbeck/Documents/Assignments/sandbox/udemynodewithreact/server/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/slicedToArray' in '/Users/aaronrbeck/Documents/Assignments/sandbox/udemynodewithreact/server/client/node_modules/react-dev-utils'

68 - changing url fixed
    for some reason when I ran npm run dev both servers started, react compiled, but I was getting a bad token error
      turns out that react was trying to start on an old login token, so I changed to 3000/auth/google and went through the 
      outh flow without a problem


83 - axios payload object was not showing up in console 
    solved via q/a forums in src/index.js needed to change 
  const store = createStore(()=>[]), {}, applyMiddleware(reduxThunk))

    to const store = createStore(reducers, {}, applyMiddleware(reduxThunk))

lesson 116 - updated package.json npm and node engine versions to allow heroku build on heroku push master
  production build via heroku push
  2019-05-20T19:45:37.555413+00:00 heroku[web.1]: Stopping all processes with SIGTERM
  2019-05-20T19:45:37.618494+00:00 heroku[web.1]: Process exited with status 143

  2019-05-20T19:48:07.121846+00:00 heroku[router]: at=error code=H12 desc="Request timeout"
  method=GET path="/auth/google/callback?code=4%2FUAEtf9f3cItDEElN_vb759ys844VZKLzlCKPygwq33u3Q80i5qJMdcpwsSF4lsMEPECAUCp-4MKU1CXXxEWw1nA&scope=email+profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email"
  host=serene-hollows-22376.herokuapp.com request_id=0177a035-d44b-4fdf-8908-f5edad1c7d0a fwd="160.2.123.187" dyno=web.1 connect=0ms service=30001ms status=503 

  2019-05-20T19:50:30.969511+00:00 heroku[router]: at=error code=H12 desc="Request timeout" method=GET
  path="/auth/google/callback?code=4%2FUAHlQCRVFlrOYbQuWWrOLaaY9Zp_1i_MCajzml6as1CK1No_bj3gHKf4xeShS-9cZPxVdr9ph-ImdFYozGp9cDE&scope=email+profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.profile+https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fuserinfo.email"

  2019-05-20T19:59:57.961489+00:00 heroku[web.1]: Stopping all processes with SIGTERM
  2019-05-20T19:59:58.234399+00:00 heroku[web.1]: Process exited with status 143

  2019-05-20T20:01:29.370065+00:00 heroku[web.1]: Stopping all processes with SIGTERM
  2019-05-20T20:01:29.458974+00:00 heroku[web.1]: Process exited with status 143

  2019-05-20T20:39:33.182616+00:00 heroku[web.1]: State changed from up to down
  2019-05-20T20:39:34.081381+00:00 heroku[web.1]: Stopping all processes with SIGTERM
  2019-05-20T20:39:34.190636+00:00 heroku[web.1]: Process exited with status 143
  2019-05-21T23:35:12.082553+00:00 heroku[web.1]: State changed from down to starting

  2019-05-21T23:35:42.479561+00:00 app[api]: Release v14 created by user beckaaronr@gmail.com
  2019-05-21T23:35:43.746196+00:00 heroku[web.1]: Stopping all processes with SIGTERM
  2019-05-21T23:35:43.853600+00:00 heroku[web.1]: Process exited with status 143

  2019-05-22T00:10:10.173733+00:00 heroku[web.1]: Stopping all processes with SIGTERM
  2019-05-22T00:10:10.419886+00:00 heroku[web.1]: Process exited with status 143
  2019-05-22T16:44:11.000000+00:00 app[api]: Build started by user beckaaronr@gmail.com
  2019-05-22T16:45:11.000000+00:00 app[api]: Build failed -- check your build output: 
  https://dashboard.heroku.com/apps/2093327c-cc7a-4378-8f15-5d1441bd0de2/activity/builds/23933741-2769-44f8-bf13-bdcac7c50564

    Steps:
    followed   https://dashboard.heroku.com/apps/2093327c-cc7a-4378-8f15-5d1441bd0de2/activity/builds/23933741-2769-44f8-bf13-bdcac7c50564
        I didn't see anything obvious
    followed: https://devcenter.heroku.com/articles/troubleshooting-node-deploys
      *buildpack looks good: heroku/nodejs
      *Compare Node and npm Versions
    Your production environment should mirror your development environment, especially in the case of important binaries. First, check your local versions:

    node --version
    npm --version
    Then, compare the results with your package.json engines section. You are specifying a node version, right?

    You can see which binaries Heroku is using on each deploy in the build logs, which look something like this:

    remote: -----> Installing binaries
    remote:        Resolving node version 10.x...
    remote:        Downloading and installing node 10.3.0...
    remote:        Using default npm version: 6.4.1
    They should match up with the same versions you saw locally. If they don’t, you should specify the matching versions in your package.json.

    ----this project:
    node --version v11.12.0
    npm --version 6.9.0
    but packagejson:
    "engines": {
    "node": "8.1.1",
    "npm": "5.0.3"
  },

  so I changed my packagejson to 
  "engines": {
    "node": "11.12.0",
    "npm": "6.9.0"
  },
  the re-pushed heroku which worked

  after logging in I did receive a pop up message saying:
  Stripe Checkout can't communicate with our payment processor
  because the API key is invalid. Please contact the website owner
  or support@stripe.com.

  I am going to ignore this for the moment, but will add it to the que of where I'm stuck


lesson 116: invalid stripe api key - changed .env.production key

  succesful push/build via heroku, however

  after logging in I received a pop up message saying:
  Stripe Checkout can't communicate with our payment processor
  because the API key is invalid. Please contact the website owner
  or support@stripe.com.
  q/a, others had same problem, someone suggested that env.production should not be in the gitignore file, 
  but I swear andrew implied that committing both .env.production and .env.development to gitignore was the thing to do
  -----went back and re-watched lesson 97
        one thing that I had missed the first time around:
        andrew used the same public key for both the .env.production and .env.development files
        i had thought that the production got the secret key
        so I went back and modifed the .env.production file
        redeploy to push heroku master
    and it worked.

139 - ReferenceError: ClickTracking is not defined
  after re-watching a couple videos back I
  changed const addClickTracking
  to const ClickTracking
  the real question is why did I not recognize that error on my own?  because I'm still at the stage of so little understanding that I'm justy copying.  get with the program, man

